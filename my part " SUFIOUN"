
CREATE USER nasim IDENTIFIED BY nasim
DEFAULT TABLESPACE users
TEMPORARY TABLESPACE temp
QUOTA UNLIMITED ON users
/

GRANT CONNECT, RESOURCE TO nasim;
GRANT DBA TO nasim;

conn nasim/nasim@orcl;

BEGIN EXECUTE IMMEDIATE 'DROP TABLE Products CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE Suppliers CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE Brand CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE Sub_categories CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP TABLE Product_categories CASCADE CONSTRAINTS'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP SEQUENCE product_categories_seq'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP SEQUENCE sub_categories_seq'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP SEQUENCE brand_seq'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP SEQUENCE suppliers_seq'; EXCEPTION WHEN OTHERS THEN NULL; END;
/
BEGIN EXECUTE IMMEDIATE 'DROP SEQUENCE products_seq'; EXCEPTION WHEN OTHERS THEN NULL; END;
/

BEGIN EXECUTE IMMEDIATE 'DROP TRIGGER trg_product_categories_bi'; EXCEPTION WHEN OTHERS THEN NULL; END;
/

BEGIN EXECUTE IMMEDIATE 'DROP TRIGGER trg_sub_categories_bi'; EXCEPTION WHEN OTHERS THEN NULL; END;
/

BEGIN EXECUTE IMMEDIATE 'DROP TRIGGER trg_suppliers_bi'; EXCEPTION WHEN OTHERS THEN NULL; END;
/

BEGIN EXECUTE IMMEDIATE 'DROP TRIGGER trg_products_bi'; EXCEPTION WHEN OTHERS THEN NULL; END;
/

BEGIN EXECUTE IMMEDIATE 'DROP TRIGGER trg_brand_bi'; EXCEPTION WHEN OTHERS THEN NULL; END;
/


CREATE TABLE product_categories (
    product_cat_id    NUMBER PRIMARY KEY,
    product_cat_name  VARCHAR2(30),
    status            NUMBER,
    cre_by            VARCHAR2(30),
    cre_dt            DATE,
    upd_by            VARCHAR2(30),
    upd_dt            DATE
);

CREATE SEQUENCE product_categories_seq START WITH 1 INCREMENT BY 1 NOCACHE NOCYCLE;

CREATE OR REPLACE TRIGGER trg_product_categories_bi
BEFORE INSERT OR UPDATE ON product_categories
REFERENCING NEW AS new OLD AS old
FOR EACH ROW
DECLARE v_seq NUMBER;
BEGIN
    IF INSERTING THEN
        IF :new.product_cat_id IS NULL THEN
            v_seq := product_categories_seq.NEXTVAL;
            :new.product_cat_id := v_seq;
        END IF;
        IF :new.status IS NULL THEN :new.status := 1; END IF;
        IF :new.cre_by IS NULL THEN :new.cre_by := NVL(V('APP_USER'), USER); END IF;
        IF :new.cre_dt IS NULL THEN :new.cre_dt := SYSDATE; END IF;
    ELSIF UPDATING THEN
        IF :new.upd_by IS NULL THEN :new.upd_by := NVL(V('APP_USER'), USER); END IF;
        IF :new.upd_dt IS NULL THEN :new.upd_dt := SYSDATE; END IF;
    END IF;
EXCEPTION WHEN OTHERS THEN RAISE;
END;
/

CREATE TABLE sub_categories (
    sub_cat_id       NUMBER PRIMARY KEY,
    sub_cat_name     VARCHAR2(30),
    product_cat_id   NUMBER,
    status           NUMBER,
    cre_by           VARCHAR2(30),
    cre_dt           DATE,
    upd_by           VARCHAR2(30),
    upd_dt           DATE,
    CONSTRAINT fk_subcat_productcat FOREIGN KEY (product_cat_id) REFERENCES product_categories(product_cat_id)
);
CREATE SEQUENCE sub_categories_seq START WITH 1 INCREMENT BY 1 NOCACHE NOCYCLE;

CREATE OR REPLACE TRIGGER trg_sub_categories_bi
BEFORE INSERT OR UPDATE ON sub_categories
REFERENCING NEW AS new OLD AS old
FOR EACH ROW
DECLARE v_seq NUMBER;
BEGIN
    IF INSERTING THEN
        IF :new.sub_cat_id IS NULL THEN
            v_seq := sub_categories_seq.NEXTVAL;
            :new.sub_cat_id := v_seq;
        END IF;
        IF :new.status IS NULL THEN :new.status := 1; END IF;
        IF :new.cre_by IS NULL THEN :new.cre_by := NVL(V('APP_USER'), USER); END IF;
        IF :new.cre_dt IS NULL THEN :new.cre_dt := SYSDATE; END IF;
    ELSIF UPDATING THEN
        IF :new.upd_by IS NULL THEN :new.upd_by := NVL(V('APP_USER'), USER); END IF;
        IF :new.upd_dt IS NULL THEN :new.upd_dt := SYSDATE; END IF;
    END IF;
EXCEPTION WHEN OTHERS THEN RAISE;
END;
/

CREATE TABLE brand (
    brand_id      NUMBER PRIMARY KEY,
    brand_name    VARCHAR2(30),
    model_name    VARCHAR2(20),
    product_size  VARCHAR2(15),
    color         VARCHAR2(10),
    status        NUMBER,
    cre_by        VARCHAR2(10),
    cre_dt        DATE,
    upd_by        VARCHAR2(10),
    upd_dt        DATE
);

CREATE SEQUENCE brand_seq START WITH 1 INCREMENT BY 1 NOCACHE NOCYCLE;

CREATE OR REPLACE TRIGGER trg_brand_bi
BEFORE INSERT OR UPDATE ON brand
REFERENCING NEW AS new OLD AS old
FOR EACH ROW
DECLARE v_seq NUMBER;
BEGIN
    IF INSERTING THEN
        IF :new.brand_id IS NULL THEN
            v_seq := brand_seq.NEXTVAL;
            :new.brand_id := v_seq;
        END IF;
        IF :new.status IS NULL THEN :new.status := 1; END IF;
        IF :new.cre_by IS NULL THEN :new.cre_by := NVL(V('APP_USER'), USER); END IF;
        IF :new.cre_dt IS NULL THEN :new.cre_dt := SYSDATE; END IF;
    ELSIF UPDATING THEN
        IF :new.upd_by IS NULL THEN :new.upd_by := NVL(V('APP_USER'), USER); END IF;
        IF :new.upd_dt IS NULL THEN :new.upd_dt := SYSDATE; END IF;
    END IF;
EXCEPTION WHEN OTHERS THEN RAISE;
END;
/

CREATE TABLE suppliers (
    supplier_id NUMBER PRIMARY KEY,
    supplier_name VARCHAR2(30) NOT NULL,
    phone_no VARCHAR2(50),
    email VARCHAR2(30),
    address VARCHAR2(30),
    contact_person VARCHAR2(30),
    cp_phone_no VARCHAR2(50),
    cp_email VARCHAR2(30),
    purchase_total NUMBER DEFAULT 0,
    pay_total NUMBER DEFAULT 0,
    due NUMBER GENERATED ALWAYS AS (NVL(purchase_total,0) - NVL(pay_total,0)) VIRTUAL,
    status NUMBER,
    cre_by VARCHAR2(20),
    cre_dt DATE,
    upd_by VARCHAR2(20),
    upd_dt DATE
);
CREATE SEQUENCE suppliers_seq START WITH 1 INCREMENT BY 1 NOCACHE NOCYCLE;

CREATE OR REPLACE TRIGGER trg_suppliers_bi
BEFORE INSERT OR UPDATE ON suppliers
REFERENCING NEW AS new OLD AS old
FOR EACH ROW
DECLARE v_seq NUMBER;
BEGIN
    IF INSERTING THEN
        IF :new.supplier_id IS NULL THEN
            v_seq := suppliers_seq.NEXTVAL;
            :new.supplier_id := v_seq;
        END IF;
        IF :new.status IS NULL THEN :new.status := 1; END IF;
        IF :new.cre_by IS NULL THEN :new.cre_by := NVL(V('APP_USER'), USER); END IF;
        IF :new.cre_dt IS NULL THEN :new.cre_dt := SYSDATE; END IF;
    ELSIF UPDATING THEN
        IF :new.upd_by IS NULL THEN :new.upd_by := NVL(V('APP_USER'), USER); END IF;
        IF :new.upd_dt IS NULL THEN :new.upd_dt := SYSDATE; END IF;
    END IF;
EXCEPTION WHEN OTHERS THEN RAISE;
END;
/

CREATE TABLE products (
    product_id        NUMBER PRIMARY KEY,
    product_code      VARCHAR2(30) UNIQUE,
    product_name      VARCHAR2(100) NOT NULL,
    subcategory_id    NUMBER,
    category_id       NUMBER,
    supplier_id       NUMBER,
    brand_id          NUMBER,
    uom               VARCHAR2(50),
    mrp               NUMBER,
    purchase_price    NUMBER,
    warranty_24_12    VARCHAR2(20),
    status            VARCHAR2(50),
    status_num        NUMBER,
    cre_by            VARCHAR2(20),
    cre_dt            DATE,
    upd_by            VARCHAR2(20),
    upd_dt            DATE,
    CONSTRAINT fk_products_supplier FOREIGN KEY (supplier_id) REFERENCES suppliers(supplier_id),
    CONSTRAINT fk_products_category FOREIGN KEY (category_id) REFERENCES product_categories(product_cat_id),
    CONSTRAINT fk_products_subcategory FOREIGN KEY (subcategory_id) REFERENCES sub_categories(sub_cat_id),
    CONSTRAINT fk_products_brand FOREIGN KEY (brand_id) REFERENCES brand(brand_id)
);

CREATE SEQUENCE products_seq START WITH 1 INCREMENT BY 1 NOCACHE NOCYCLE;

CREATE OR REPLACE TRIGGER trg_products_bi
BEFORE INSERT OR UPDATE ON products
REFERENCING NEW AS new OLD AS old
FOR EACH ROW
DECLARE v_seq NUMBER;
BEGIN
    IF INSERTING THEN
        IF :new.product_id IS NULL THEN
            v_seq := products_seq.NEXTVAL;
            :new.product_id := v_seq;
        END IF;
        IF :new.status_num IS NULL THEN :new.status_num := 1; END IF;
        IF :new.cre_by IS NULL THEN :new.cre_by := NVL(V('APP_USER'), USER); END IF;
        IF :new.cre_dt IS NULL THEN :new.cre_dt := SYSDATE; END IF;
    ELSIF UPDATING THEN
        IF :new.upd_by IS NULL THEN :new.upd_by := NVL(V('APP_USER'), USER); END IF;
        IF :new.upd_dt IS NULL THEN :new.upd_dt := SYSDATE; END IF;
    END IF;
EXCEPTION WHEN OTHERS THEN RAISE;
END;
/

COMMIT;

INSERT INTO product_categories (product_cat_id, product_cat_name, status)
VALUES (product_categories_seq.NEXTVAL, 'Networking Devices', 1);

INSERT INTO product_categories (product_cat_id, product_cat_name, status)
VALUES (product_categories_seq.NEXTVAL, 'Audio Systems', 1);

INSERT INTO product_categories (product_cat_id, product_cat_name, status)
VALUES (product_categories_seq.NEXTVAL, 'Cameras', 1);

INSERT INTO product_categories (product_cat_id, product_cat_name, status)
VALUES (product_categories_seq.NEXTVAL, 'Storage Devices', 1);

INSERT INTO product_categories (product_cat_id, product_cat_name, status)
VALUES (product_categories_seq.NEXTVAL, 'Gaming Accessories', 1);


INSERT INTO sub_categories (sub_cat_id, sub_cat_name, product_cat_id, status)
VALUES (sub_categories_seq.NEXTVAL, 'Wi-Fi Routers', 1, 1);

INSERT INTO sub_categories (sub_cat_id, sub_cat_name, product_cat_id, status)
VALUES (sub_categories_seq.NEXTVAL, 'Bluetooth Speakers', 2, 1);

INSERT INTO sub_categories (sub_cat_id, sub_cat_name, product_cat_id, status)
VALUES (sub_categories_seq.NEXTVAL, 'DSLR Cameras', 3, 1);

INSERT INTO sub_categories (sub_cat_id, sub_cat_name, product_cat_id, status)
VALUES (sub_categories_seq.NEXTVAL, 'External Hard Drives', 4, 1);

INSERT INTO sub_categories (sub_cat_id, sub_cat_name, product_cat_id, status)
VALUES (sub_categories_seq.NEXTVAL, 'Gaming Headsets', 5, 1);


INSERT INTO brand (brand_id, brand_name, model_name, product_size, color, status)
VALUES (brand_seq.NEXTVAL, 'TP-Link', 'Archer C6', 'Standard', 'Black', 1);

INSERT INTO brand (brand_id, brand_name, model_name, product_size, color, status)
VALUES (brand_seq.NEXTVAL, 'JBL', 'Flip 6', 'Portable', 'Black', 1);

INSERT INTO brand (brand_id, brand_name, model_name, product_size, color, status)
VALUES (brand_seq.NEXTVAL, 'Canon', 'EOS 90D', 'Body Only', 'Black', 1);

INSERT INTO brand (brand_id, brand_name, model_name, product_size, color, status)
VALUES (brand_seq.NEXTVAL, 'Seagate', 'Backup Plus 2TB', '2TB', 'Black', 1);

INSERT INTO brand (brand_id, brand_name, model_name, product_size, color, status)
VALUES (brand_seq.NEXTVAL, 'Razer', 'Kraken X', 'Standard', 'Green', 1);

INSERT INTO suppliers (
    supplier_id, supplier_name, phone_no, email, address,
    contact_person, cp_phone_no, cp_email, status
) VALUES (
    suppliers_seq.NEXTVAL, 'NetWorld Distributors', '+8801700000006', 'sales@networld.com', 'Dhaka, Bangladesh',
    'Fahim Rahman', '+8801711000006', 'fahim@networld.com', 1
);

INSERT INTO suppliers (
    supplier_id, supplier_name, phone_no, email, address,
    contact_person, cp_phone_no, cp_email, status
) VALUES (
    suppliers_seq.NEXTVAL, 'SoundWave BD', '+8801700000007', 'info@soundwave.com', 'Dhaka, Bangladesh',
    'Lamia Hasan', '+8801711000007', 'lamia@soundwave.com', 1
);

INSERT INTO suppliers (
    supplier_id, supplier_name, phone_no, email, address,
    contact_person, cp_phone_no, cp_email, status
) VALUES (
    suppliers_seq.NEXTVAL, 'Camera House', '+8801700000008', 'support@camerahouse.com', 'Chattogram, Bangladesh',
    'Mahmudul Islam', '+8801711000008', 'mahmud@camerahouse.com', 1
);

INSERT INTO suppliers (
    supplier_id, supplier_name, phone_no, email, address,
    contact_person, cp_phone_no, cp_email, status
) VALUES (
    suppliers_seq.NEXTVAL, 'Storage Point', '+8801700000009', 'service@storagepoint.com', 'Dhaka, Bangladesh',
    'Shamima Sultana', '+8801711000009', 'shamima@storagepoint.com', 1
);

INSERT INTO suppliers (
    supplier_id, supplier_name, phone_no, email, address,
    contact_person, cp_phone_no, cp_email, status
) VALUES (
    suppliers_seq.NEXTVAL, 'Gamer Zone Supply', '+8801700000010', 'contact@gamerzone.com', 'Dhaka, Bangladesh',
    'Rashid Khan', '+8801711000010', 'rashid@gamerzone.com', 1
);


-- TP-Link Archer C6 Router
INSERT INTO products (
    product_id, product_code, product_name,
    supplier_id, category_id, subcategory_id, brand_id,
    uom, mrp, purchase_price,
    warranty_24_12, status, status_num
) VALUES (
    products_seq.NEXTVAL, 'PRD-0006', 'TP-Link Archer C6 Router',
    1, 1, 1, 1,          -- NetWorld, Networking Devices, Wi-Fi Routers, TP-Link
    'PCS', 3500, 3000,
    '12', 'Active', 1
);

-- JBL Flip 6 Bluetooth Speaker
INSERT INTO products (
    product_id, product_code, product_name,
    supplier_id, category_id, subcategory_id, brand_id,
    uom, mrp, purchase_price,
    warranty_24_12, status, status_num
) VALUES (
    products_seq.NEXTVAL, 'PRD-0007', 'JBL Flip 6 Bluetooth Speaker',
    2, 2, 2, 2,          -- SoundWave BD, Audio Systems, Bluetooth Speakers, JBL
    'PCS', 12000, 10000,
    '12', 'Active', 1
);

-- Canon EOS 90D DSLR Camera
INSERT INTO products (
    product_id, product_code, product_name,
    supplier_id, category_id, subcategory_id, brand_id,
    uom, mrp, purchase_price,
    warranty_24_12, status, status_num
) VALUES (
    products_seq.NEXTVAL, 'PRD-0008', 'Canon EOS 90D DSLR Camera',
    3, 3, 3, 3,          -- Camera House, Cameras, DSLR Cameras, Canon
    'PCS', 150000, 135000,
    '12', 'Active', 1
);

-- Seagate Backup Plus 2TB
INSERT INTO products (
    product_id, product_code, product_name,
    supplier_id, category_id, subcategory_id, brand_id,
    uom, mrp, purchase_price,
    warranty_24_12, status, status_num
) VALUES (
    products_seq.NEXTVAL, 'PRD-0009', 'Seagate Backup Plus 2TB',
    4, 4, 4, 4,          -- Storage Point, Storage Devices, External Hard Drives, Seagate
    'PCS', 8000, 6500,
    '12', 'Active', 1
);

-- Razer Kraken X Gaming Headset
INSERT INTO products (
    product_id, product_code, product_name,
    supplier_id, category_id, subcategory_id, brand_id,
    uom, mrp, purchase_price,
    warranty_24_12, status, status_num
) VALUES (
    products_seq.NEXTVAL, 'PRD-0010', 'Razer Kraken X Gaming Headset',
    5, 5, 5, 5,          -- Gamer Zone Supply, Gaming Accessories, Gaming Headsets, Razer
    'PCS', 7000, 5500,
    '12', 'Active', 1
);

commit;
